<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>和粋 WASUI - 管理画面</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Noto+Serif+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        /* ログイン画面 */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #2d5f3f, #4a7c59);
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo h1 {
            color: #2d5f3f;
            font-size: 2rem;
            margin-bottom: 5px;
            font-family: 'Noto Serif JP', serif;
        }

        .login-logo .logo-sub {
            color: #d4af37;
            font-size: 1.2rem;
            font-weight: 400;
            letter-spacing: 2px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #2d5f3f;
            box-shadow: 0 0 0 3px rgba(45, 95, 63, 0.1);
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #2d5f3f, #4a7c59);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: linear-gradient(135deg, #4a7c59, #2d5f3f);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(45, 95, 63, 0.3);
        }

        /* 管理画面のメインスタイル */
        .admin-container {
            display: none;
            min-height: 100vh;
            flex-direction: row;
        }

        .admin-sidebar {
            width: 280px;
            background: linear-gradient(180deg, #2d5f3f, #1a3d2e);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 30px 20px;
            text-align: center;
            border-bottom: 1px solid #4a7c59;
        }

        .sidebar-header h2 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            font-family: 'Noto Serif JP', serif;
        }

        .sidebar-header .logo-sub {
            color: #d4af37;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }

        .menu-items {
            list-style: none;
            padding: 20px 0;
        }

        .menu-item {
            display: block;
            padding: 15px 25px;
            color: #ecf0f1;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid transparent;
        }

        .menu-item:hover,
        .menu-item.active {
            background: rgba(255,255,255,0.1);
            border-left-color: #d4af37;
        }

        .main-content {
            margin-left: 280px;
            padding: 30px;
            width: calc(100% - 280px);
        }

        .page-header {
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 2rem;
            color: #2d5f3f;
            margin-bottom: 10px;
            font-family: 'Noto Serif JP', serif;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .content-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .card-header {
            padding: 20px 30px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-body {
            padding: 30px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2d5f3f, #4a7c59);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #4a7c59, #2d5f3f);
            transform: translateY(-1px);
        }

        /* モーダル */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 20px 30px;
            background: linear-gradient(135deg, #2d5f3f, #4a7c59);
            color: white;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 30px;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        /* テーブル */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2d5f3f;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-edit {
            background: #17a2b8;
            color: white;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        /* 統計カード */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2d5f3f;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-weight: 500;
        }

        /* 画像アップロード機能のスタイル */
        .file-upload-container {
            margin-bottom: 15px;
        }

        .file-upload-btn {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(135deg, #2d5f3f, #4a7c59);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .file-upload-btn:hover {
            background: linear-gradient(135deg, #4a7c59, #2d5f3f);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(45, 95, 63, 0.3);
        }

        .image-preview {
            margin-top: 10px;
            padding: 10px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            text-align: center;
            min-height: 60px;
            background: #fafafa;
        }

        .image-preview-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .image-preview img {
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .image-preview img:hover {
            transform: scale(1.05);
        }

        /* フォームの改善 */
        .help-text {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        .help-icon {
            display: inline-block;
            margin-left: 5px;
            color: #2d5f3f;
            cursor: help;
            font-size: 14px;
        }

        /* 通知 */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            font-weight: 500;
            z-index: 2000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .notification.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* レスポンシブ */
        @media (max-width: 768px) {
            .admin-sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .admin-sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 20px;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
            }

            .modal-body {
                padding: 20px;
            }
        }

        /* カテゴリ別カラー */
        .category-baum { background: #f8f4e6; color: #d4af37; border-left: 4px solid #d4af37; }
        .category-seasonal { background: #ffebee; color: #ff6b6b; border-left: 4px solid #ff6b6b; }
        .category-gift { background: #e0f7fa; color: #4ecdc4; border-left: 4px solid #4ecdc4; }
        .category-baked { background: #fce4ec; color: #e91e63; border-left: 4px solid #e91e63; }
        .category-other { background: #f3e5f5; color: #9b59b6; border-left: 4px solid #9b59b6; }
        .category-default { background: #f5f5f5; color: #666; border-left: 4px solid #ccc; }

        /* レビュー用カテゴリカラー */
        .category-review { background: #fff8e1; color: #ff8f00; border-left: 4px solid #ff8f00; }

        /* ギフトサービス表示 */
        .gift-services {
            margin-top: 8px;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 0.9em;
            color: #666;
        }

        /* チェックボックスグループ */
        .checkbox-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: normal;
        }

        /* お知らせカテゴリカラー */
        .category-new { background: #e8f5e8; color: #2e7d32; }
        .category-campaign { background: #fff3e0; color: #f57c00; }
        .category-notice { background: #e3f2fd; color: #1976d2; }
        .category-event { background: #f3e5f5; color: #7b1fa2; }
        .category-important { background: #ffebee; color: #c62828; }

        /* 優先度カラー */
        .status-warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <!-- ログイン画面 -->
    <div id="login-container" class="login-container">
        <div class="login-box">
            <div class="login-logo">
                <h1>和粋</h1>
                <div class="logo-sub">WASUI</div>
                <p style="margin-top: 15px; color: #666;">管理画面へログイン</p>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">ユーザー名</label>
                    <input type="text" id="username" class="form-control" value="wasui_admin" required>
                </div>
                <div class="form-group">
                    <label for="password">パスワード</label>
                    <input type="password" id="password" class="form-control" value="wasui2024" required>
                </div>
                <button type="submit" class="btn">
                    <i class="fas fa-sign-in-alt"></i> ログイン
                </button>
            </form>
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 0.85rem; color: #666;">
                <strong>🍡 和粋 CMS管理システム</strong><br>
                ✅ お知らせ・商品・ギフト・お客様の声の管理<br>
                ✅ 画像アップロード機能<br>
                ✅ レスポンシブ対応<br><br>
                <strong>ログイン情報:</strong><br>
                ユーザー名: wasui_admin<br>
                パスワード: wasui2024
            </div>
        </div>
    </div>

    <!-- メイン管理画面 -->
    <div id="admin-container" class="admin-container">
        <!-- サイドバー -->
        <nav class="admin-sidebar">
            <div class="sidebar-header">
                <h2>和粋</h2>
                <div class="logo-sub">WASUI</div>
                <p>管理システム</p>
            </div>
            <ul class="menu-items">
                <li class="menu-item active" data-section="dashboard">
                    <i class="fas fa-chart-bar"></i> ダッシュボード
                </li>
                <li class="menu-item" data-section="news">
                    <i class="fas fa-newspaper"></i> お知らせ管理
                </li>
                <li class="menu-item" data-section="products">
                    <i class="fas fa-cookie-bite"></i> 商品管理
                </li>
                <li class="menu-item" data-section="gifts">
                    <i class="fas fa-gift"></i> ギフト管理
                </li>
                <li class="menu-item" data-section="reviews">
                    <i class="fas fa-star"></i> お客様の声管理
                </li>
                <li class="menu-item" data-section="settings">
                    <i class="fas fa-cog"></i> サイト設定
                </li>
                <li class="menu-item" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> ログアウト
                </li>
            </ul>
        </nav>

        <!-- メインコンテンツ -->
        <main class="main-content">
            <!-- ダッシュボード -->
            <section id="dashboard" class="section active">
                <div class="page-header">
                    <h1 class="page-title">📊 ダッシュボード</h1>
                    <p>和粋の管理状況を確認できます</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="stats-news">0</div>
                        <div class="stat-label">お知らせ件数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="stats-products">0</div>
                        <div class="stat-label">登録商品数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="stats-gifts">0</div>
                        <div class="stat-label">ギフト商品数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="stats-reviews">0</div>
                        <div class="stat-label">お客様の声</div>
                    </div>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3>🍡 和粋 CMS管理システム</h3>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; gap: 15px;">
                            <div style="padding: 15px; background: #e8f5e8; border-radius: 8px; border-left: 4px solid #4caf50;">
                                <strong>📰 お知らせ管理</strong><br>
                                新着情報、イベント情報、お店からのお知らせを管理
                            </div>
                            <div style="padding: 15px; background: #fff3e0; border-radius: 8px; border-left: 4px solid #ff9800;">
                                <strong>🍰 商品管理</strong><br>
                                バウムクーヘン、季節限定品、焼き菓子などの商品情報を管理
                            </div>
                            <div style="padding: 15px; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #2196f3;">
                                <strong>🎁 ギフト管理</strong><br>
                                お祝い、お歳暮、内祝いなどシーン別ギフト商品を管理
                            </div>
                            <div style="padding: 15px; background: #f3e5f5; border-radius: 8px; border-left: 4px solid #9c27b0;">
                                <strong>⭐ お客様の声管理</strong><br>
                                レビューや評価、お客様からのメッセージを管理
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- お知らせ管理 -->
            <section id="news" class="section">
                <div class="page-header">
                    <h1 class="page-title">📰 お知らせ管理</h1>
                    <p>お知らせの追加・編集・削除ができます</p>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3>お知らせ一覧</h3>
                        <button class="btn-primary" onclick="openNewsModal()">
                            <i class="fas fa-plus"></i> 新規お知らせ
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="news-list">
                            <p>お知らせを読み込み中...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 商品管理 -->
            <section id="products" class="section">
                <div class="page-header">
                    <h1 class="page-title">🍰 商品管理</h1>
                    <p>商品情報の追加・編集・削除ができます</p>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3>商品一覧</h3>
                        <button class="btn-primary" onclick="openProductModal()">
                            <i class="fas fa-plus"></i> 新規商品
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="products-list">
                            <p>商品情報を読み込み中...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ギフト管理 -->
            <section id="gifts" class="section">
                <div class="page-header">
                    <h1 class="page-title">🎁 ギフト管理</h1>
                    <p>ギフト商品の追加・編集・削除ができます</p>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3>ギフト一覧</h3>
                        <button class="btn-primary" onclick="openGiftModal()">
                            <i class="fas fa-plus"></i> 新規ギフト
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="gifts-list">
                            <p>ギフト情報を読み込み中...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- お客様の声管理 -->
            <section id="reviews" class="section">
                <div class="page-header">
                    <h1 class="page-title">⭐ お客様の声管理</h1>
                    <p>レビューの追加・編集・削除ができます</p>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3>レビュー一覧</h3>
                        <button class="btn-primary" onclick="openReviewModal()">
                            <i class="fas fa-plus"></i> 新規レビュー
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="reviews-list">
                            <p>レビューを読み込み中...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- サイト設定 -->
            <section id="settings" class="section">
                <div class="page-header">
                    <h1 class="page-title">⚙️ サイト設定</h1>
                    <p>サイト全体の設定を管理できます</p>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3>基本設定</h3>
                    </div>
                    <div class="card-body">
                        <form id="settings-form">
                            <div class="form-group">
                                <label>サイト名</label>
                                <input type="text" id="site-name" class="form-control" placeholder="和粋 WASUI">
                            </div>

                            <div class="form-group">
                                <label>電話番号</label>
                                <input type="text" id="site-phone" class="form-control" placeholder="03-1234-5678">
                            </div>

                            <div class="form-group">
                                <label>住所</label>
                                <input type="text" id="site-address" class="form-control" placeholder="〒123-4567 東京都...">
                            </div>

                            <div class="form-group">
                                <label>営業時間</label>
                                <input type="text" id="site-hours" class="form-control" placeholder="9:00〜19:00（水曜定休）">
                            </div>

                            <div class="form-group">
                                <label>メールアドレス</label>
                                <input type="email" id="site-email" class="form-control" placeholder="info@wasui.com">
                            </div>

                            <div class="form-group">
                                <label>サイト説明</label>
                                <textarea id="site-description" class="form-control" rows="3" placeholder="和粋は伝統の技と心を込めたバウムクーヘン専門店です..."></textarea>
                                <div class="help-text">サイトのメタディスクリプションや紹介文に使用されます</div>
                            </div>

                            <div class="form-group">
                                <label>SNSリンク</label>
                                <div class="form-row">
                                    <div class="form-group">
                                        <input type="url" id="site-facebook" class="form-control" placeholder="Facebook URL">
                                    </div>
                                    <div class="form-group">
                                        <input type="url" id="site-instagram" class="form-control" placeholder="Instagram URL">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <input type="url" id="site-twitter" class="form-control" placeholder="Twitter URL">
                                    </div>
                                    <div class="form-group">
                                        <input type="url" id="site-line" class="form-control" placeholder="LINE公式アカウント URL">
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>配送・支払い情報</label>
                                <textarea id="site-shipping" class="form-control" rows="3" placeholder="配送料：全国一律500円（5,000円以上送料無料）&#10;支払方法：クレジットカード、銀行振込、代金引換"></textarea>
                                <div class="help-text">配送と支払いに関する基本情報を入力してください</div>
                            </div>

                            <div class="form-group">
                                <label>特別なお知らせ</label>
                                <textarea id="site-notice" class="form-control" rows="2" placeholder="年末年始は12月30日〜1月3日まで休業いたします"></textarea>
                                <div class="help-text">サイト全体に表示する重要なお知らせがあれば入力してください</div>
                            </div>

                            <div style="margin-top: 30px;">
                                <button type="submit" class="btn-primary">設定を保存</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- データエクスポート -->
                <div class="content-card">
                    <div class="card-header">
                        <h3>データエクスポート</h3>
                    </div>
                    <div class="card-body">
                        <p>CMSデータをJSONファイルとしてエクスポートし、フロントエンドサイトで利用できます。</p>
                        <div style="margin-top: 20px;">
                            <button type="button" class="btn-primary" onclick="exportAllData()">
                                <i class="fas fa-download"></i> 全データをエクスポート
                            </button>
                            <small style="display: block; margin-top: 10px; color: #666;">
                                エクスポートされたJSONファイルを<code>/public/data/</code>フォルダにアップロードしてください。
                            </small>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- モーダル: お知らせ -->
    <div id="news-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h4 id="news-modal-title">新規お知らせ</h4>
                <span class="close" onclick="closeNewsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="news-form">
                    <div class="form-group">
                        <label>タイトル <i class="fas fa-question-circle help-icon"></i></label>
                        <input type="text" id="news-title" class="form-control" placeholder="例：新商品「抹茶バウムクーヘン」発売開始" required>
                        <div class="help-text">お客様にわかりやすい簡潔なタイトルを入力してください</div>
                    </div>

                    <div class="form-group">
                        <label>カテゴリ <i class="fas fa-question-circle help-icon"></i></label>
                        <select id="news-category" class="form-control" required>
                            <option value="">カテゴリを選択</option>
                            <option value="新商品">新商品</option>
                            <option value="キャンペーン">キャンペーン</option>
                            <option value="お知らせ">お知らせ</option>
                            <option value="イベント">イベント</option>
                            <option value="重要">重要なお知らせ</option>
                        </select>
                        <div class="help-text">お知らせの種類を選択してください</div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>公開日 <i class="fas fa-question-circle help-icon"></i></label>
                            <input type="date" id="news-date" class="form-control" required>
                            <div class="help-text">お知らせの公開日を設定してください</div>
                        </div>

                        <div class="form-group">
                            <label>優先度 <i class="fas fa-question-circle help-icon"></i></label>
                            <select id="news-priority" class="form-control">
                                <option value="normal">通常</option>
                                <option value="high">高</option>
                                <option value="urgent">緊急</option>
                            </select>
                            <div class="help-text">表示優先度を選択してください</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>概要 <i class="fas fa-question-circle help-icon"></i></label>
                        <textarea id="news-summary" class="form-control" rows="3" placeholder="お知らせの概要を簡潔に説明してください" required></textarea>
                        <div class="help-text">一覧表示で使用される短い説明文です（100文字程度）</div>
                    </div>

                    <div class="form-group">
                        <label>詳細内容 <i class="fas fa-question-circle help-icon"></i></label>
                        <textarea id="news-content" class="form-control" rows="6" placeholder="お知らせの詳細内容を入力してください"></textarea>
                        <div class="help-text">詳細ページで表示される本文です</div>
                    </div>

                    <div class="form-group">
                        <label>お知らせ画像 <i class="fas fa-question-circle help-icon"></i></label>
                        <div class="file-upload-container">
                            <input type="file" id="news-image-file" accept="image/*" onchange="handleImageUpload(this, 'news-image-preview')" style="display: none;">
                            <button type="button" onclick="document.getElementById('news-image-file').click()" class="file-upload-btn">
                                📸 画像を選択（2MB以下）
                            </button>
                            <div id="news-image-preview" class="image-preview"></div>
                            <input type="hidden" id="news-image" name="news-image">
                        </div>
                        <div class="help-text">お知らせに添付する画像をアップロードしてください（JPG, PNG形式、2MB以下）</div>
                    </div>

                    <div class="form-group">
                        <label>タグ <i class="fas fa-question-circle help-icon"></i></label>
                        <input type="text" id="news-tags" class="form-control" placeholder="例：新商品,バウムクーヘン,限定">
                        <div class="help-text">検索用のタグをカンマ区切りで入力してください</div>
                    </div>

                    <div style="display: flex; gap: 20px; align-items: center; margin-top: 20px;">
                        <label>
                            <input type="checkbox" id="news-featured"> 注目記事として表示
                        </label>
                        <label>
                            <input type="checkbox" id="news-active" checked> 公開する
                        </label>
                    </div>

                    <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="closeNewsModal()">キャンセル</button>
                        <button type="submit" class="btn btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 商品管理モーダル -->
    <div id="product-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="product-modal-title">新規商品登録</h3>
                <span class="close" onclick="closeProductModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="product-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>商品名 <span class="required">*</span></label>
                            <input type="text" id="product-title" class="form-control" placeholder="例：特選バウムクーヘン" required>
                            <div class="help-text">商品の正式名称を入力してください</div>
                        </div>
                        <div class="form-group">
                            <label>カテゴリ <span class="required">*</span></label>
                            <select id="product-category" class="form-control" required>
                                <option value="">カテゴリを選択</option>
                                <option value="バウムクーヘン">バウムクーヘン</option>
                                <option value="季節限定品">季節限定品</option>
                                <option value="ギフトセット">ギフトセット</option>
                                <option value="焼菓子">焼菓子</option>
                                <option value="その他">その他</option>
                            </select>
                            <div class="help-text">商品のカテゴリを選択してください</div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>価格 <span class="required">*</span></label>
                            <input type="text" id="product-price" class="form-control" placeholder="例：1,500円" required>
                            <div class="help-text">税込価格を入力してください</div>
                        </div>
                        <div class="form-group">
                            <label>販売開始日</label>
                            <input type="date" id="product-date" class="form-control">
                            <div class="help-text">商品の販売開始日を選択してください</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>商品説明 <span class="required">*</span></label>
                        <textarea id="product-description" class="form-control" rows="4" placeholder="商品の詳細な説明を入力してください" required></textarea>
                        <div class="help-text">商品の特徴や魅力を詳しく説明してください</div>
                    </div>

                    <div class="form-group">
                        <label>原材料・アレルギー情報</label>
                        <textarea id="product-ingredients" class="form-control" rows="3" placeholder="例：小麦粉、卵、バター、砂糖（特定原材料：小麦、卵、乳）"></textarea>
                        <div class="help-text">原材料とアレルギー情報を記載してください</div>
                    </div>

                    <div class="form-group">
                        <label>商品画像</label>
                        <div class="file-upload-container">
                            <input type="file" id="product-image-file" accept="image/*" onchange="handleImageUpload(this, 'product-image-preview')" style="display: none;">
                            <button type="button" onclick="document.getElementById('product-image-file').click()" class="file-upload-btn">
                                📸 画像を選択（2MB以下）
                            </button>
                            <div id="product-image-preview" class="image-preview"></div>
                            <input type="hidden" id="product-image" name="product-image">
                        </div>
                        <div class="help-text">商品の画像をアップロードしてください（JPG, PNG形式、2MB以下）</div>
                    </div>

                    <div class="form-group">
                        <label>検索タグ</label>
                        <input type="text" id="product-tags" class="form-control" placeholder="例：バウム,人気,ギフト">
                        <div class="help-text">検索用のタグをカンマ区切りで入力してください</div>
                    </div>

                    <div style="display: flex; gap: 20px; align-items: center; margin-top: 20px;">
                        <label>
                            <input type="checkbox" id="product-featured"> おすすめ商品として表示
                        </label>
                        <label>
                            <input type="checkbox" id="product-active" checked> 販売中
                        </label>
                    </div>

                    <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="closeProductModal()">キャンセル</button>
                        <button type="submit" class="btn btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ギフト管理モーダル -->
    <div id="gift-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="gift-modal-title">新規ギフト登録</h3>
                <span class="close" onclick="closeGiftModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="gift-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>ギフト名 <span class="required">*</span></label>
                            <input type="text" id="gift-title" class="form-control" placeholder="例：季節のギフトセット" required>
                            <div class="help-text">ギフトの正式名称を入力してください</div>
                        </div>
                        <div class="form-group">
                            <label>ギフトタイプ <span class="required">*</span></label>
                            <select id="gift-type" class="form-control" required>
                                <option value="">タイプを選択</option>
                                <option value="詰合せ">詰合せ</option>
                                <option value="ギフトボックス">ギフトボックス</option>
                                <option value="季節限定">季節限定</option>
                                <option value="のし対応">のし対応</option>
                                <option value="カスタムギフト">カスタムギフト</option>
                            </select>
                            <div class="help-text">ギフトのタイプを選択してください</div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>価格 <span class="required">*</span></label>
                            <input type="text" id="gift-price" class="form-control" placeholder="例：3,000円〜" required>
                            <div class="help-text">ギフトの価格帯を入力してください</div>
                        </div>
                        <div class="form-group">
                            <label>販売開始日</label>
                            <input type="date" id="gift-date" class="form-control">
                            <div class="help-text">ギフトの販売開始日を選択してください</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>ギフト内容 <span class="required">*</span></label>
                        <textarea id="gift-contents" class="form-control" rows="4" placeholder="ギフトに含まれる商品や内容を詳しく説明してください" required></textarea>
                        <div class="help-text">ギフトの内容を詳しく説明してください</div>
                    </div>

                    <div class="form-group">
                        <label>ギフト説明</label>
                        <textarea id="gift-description" class="form-control" rows="3" placeholder="ギフトの特徴や贈り物としての魅力を説明してください"></textarea>
                        <div class="help-text">ギフトの特徴や魅力を説明してください</div>
                    </div>

                    <div class="form-group">
                        <label>のし・包装対応</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" id="gift-noshi"> のし対応可能</label>
                            <label><input type="checkbox" id="gift-wrapping"> 包装対応可能</label>
                            <label><input type="checkbox" id="gift-message"> メッセージカード対応</label>
                        </div>
                        <div class="help-text">対応可能なサービスを選択してください</div>
                    </div>

                    <div class="form-group">
                        <label>ギフト画像</label>
                        <div class="file-upload-container">
                            <input type="file" id="gift-image-file" accept="image/*" onchange="handleImageUpload(this, 'gift-image-preview')" style="display: none;">
                            <button type="button" onclick="document.getElementById('gift-image-file').click()" class="file-upload-btn">
                                📸 画像を選択（2MB以下）
                            </button>
                            <div id="gift-image-preview" class="image-preview"></div>
                            <input type="hidden" id="gift-image" name="gift-image">
                        </div>
                        <div class="help-text">ギフトの画像をアップロードしてください（JPG, PNG形式、2MB以下）</div>
                    </div>

                    <div class="form-group">
                        <label>検索タグ</label>
                        <input type="text" id="gift-tags" class="form-control" placeholder="例：ギフト,お祝い,季節">
                        <div class="help-text">検索用のタグをカンマ区切りで入力してください</div>
                    </div>

                    <div style="display: flex; gap: 20px; align-items: center; margin-top: 20px;">
                        <label>
                            <input type="checkbox" id="gift-featured"> おすすめギフトとして表示
                        </label>
                        <label>
                            <input type="checkbox" id="gift-active" checked> 販売中
                        </label>
                    </div>

                    <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="closeGiftModal()">キャンセル</button>
                        <button type="submit" class="btn btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- お客様の声管理モーダル -->
    <div id="review-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="review-modal-title">新規お客様の声登録</h3>
                <span class="close" onclick="closeReviewModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="review-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>お客様名 <span class="required">*</span></label>
                            <input type="text" id="review-customer-name" class="form-control" placeholder="例：田中様" required>
                            <div class="help-text">お客様のお名前を入力してください</div>
                        </div>
                        <div class="form-group">
                            <label>評価 <span class="required">*</span></label>
                            <select id="review-rating" class="form-control" required>
                                <option value="">評価を選択</option>
                                <option value="5">★★★★★ (5つ星)</option>
                                <option value="4">★★★★☆ (4つ星)</option>
                                <option value="3">★★★☆☆ (3つ星)</option>
                                <option value="2">★★☆☆☆ (2つ星)</option>
                                <option value="1">★☆☆☆☆ (1つ星)</option>
                            </select>
                            <div class="help-text">お客様の評価を選択してください</div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>購入商品</label>
                            <input type="text" id="review-product" class="form-control" placeholder="例：特選バウムクーヘン">
                            <div class="help-text">購入された商品名を入力してください</div>
                        </div>
                        <div class="form-group">
                            <label>投稿日</label>
                            <input type="date" id="review-date" class="form-control">
                            <div class="help-text">レビューの投稿日を選択してください</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>お客様の声 <span class="required">*</span></label>
                        <textarea id="review-content" class="form-control" rows="4" placeholder="お客様からいただいた感想やコメントを入力してください" required></textarea>
                        <div class="help-text">お客様の感想を詳しく入力してください</div>
                    </div>

                    <div class="form-group">
                        <label>お客様情報</label>
                        <div class="form-row">
                            <div class="form-group">
                                <input type="text" id="review-age" class="form-control" placeholder="年代（例：30代）">
                            </div>
                            <div class="form-group">
                                <select id="review-gender" class="form-control">
                                    <option value="">性別を選択</option>
                                    <option value="男性">男性</option>
                                    <option value="女性">女性</option>
                                    <option value="その他">その他</option>
                                </select>
                            </div>
                        </div>
                        <div class="help-text">お客様の年代と性別を入力してください（任意）</div>
                    </div>

                    <div class="form-group">
                        <label>お客様写真</label>
                        <div class="file-upload-container">
                            <input type="file" id="review-image-file" accept="image/*" onchange="handleImageUpload(this, 'review-image-preview')" style="display: none;">
                            <button type="button" onclick="document.getElementById('review-image-file').click()" class="file-upload-btn">
                                📸 画像を選択（2MB以下）
                            </button>
                            <div id="review-image-preview" class="image-preview"></div>
                            <input type="hidden" id="review-image" name="review-image">
                        </div>
                        <div class="help-text">お客様の写真や商品の写真をアップロードしてください（JPG, PNG形式、2MB以下）</div>
                    </div>

                    <div class="form-group">
                        <label>タグ</label>
                        <input type="text" id="review-tags" class="form-control" placeholder="例：リピーター,ギフト,お祝い">
                        <div class="help-text">検索用のタグをカンマ区切りで入力してください</div>
                    </div>

                    <div style="display: flex; gap: 20px; align-items: center; margin-top: 20px;">
                        <label>
                            <input type="checkbox" id="review-featured"> おすすめレビューとして表示
                        </label>
                        <label>
                            <input type="checkbox" id="review-active" checked> 公開する
                        </label>
                    </div>

                    <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="closeReviewModal()">キャンセル</button>
                        <button type="submit" class="btn btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 通知 -->
    <div id="notification" class="notification"></div>

    <script>
        // 管理システム基本機能
        let currentData = null;
        let isAuthenticated = false;
        let currentUser = null;

        // 認証情報
        const validCredentials = {
            'wasui_admin': 'wasui2024'
        };

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            initializeWasuiAdmin();
        });

        function initializeWasuiAdmin() {
            checkAuthentication();
            setupEventListeners();
            loadData();
        }

        function checkAuthentication() {
            const authData = localStorage.getItem('wasui_auth');
            if (authData) {
                try {
                    const auth = JSON.parse(authData);
                    if (auth.expiry > Date.now()) {
                        isAuthenticated = true;
                        currentUser = auth.username;
                        showDashboard();
                        return;
                    }
                } catch (error) {
                    console.error('Auth check error:', error);
                }
            }
            showLogin();
        }

        function setupEventListeners() {
            // ログインフォーム
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                login();
            });

            // メニューナビゲーション
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.dataset.section;
                    if (section) {
                        showSection(section);
                    }
                });
            });

            // サイト設定フォーム
            document.getElementById('settings-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveSettings();
            });

            // お知らせフォーム
            document.getElementById('news-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveNews();
            });

            // 商品フォーム
            document.getElementById('product-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveProduct();
            });

            // ギフトフォーム
            document.getElementById('gift-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveGift();
            });

            // レビューフォーム
            document.getElementById('review-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveReview();
            });
        }

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (validCredentials[username] === password) {
                const authData = {
                    username: username,
                    expiry: Date.now() + (24 * 60 * 60 * 1000) // 24時間
                };
                localStorage.setItem('wasui_auth', JSON.stringify(authData));

                isAuthenticated = true;
                currentUser = username;
                showDashboard();
                showNotification('ログインしました', 'success');
            } else {
                showNotification('ユーザー名またはパスワードが正しくありません', 'error');
            }
        }

        function logout() {
            localStorage.removeItem('wasui_auth');
            isAuthenticated = false;
            currentUser = null;
            showLogin();
            showNotification('ログアウトしました', 'success');
        }

        function showLogin() {
            document.getElementById('login-container').style.display = 'flex';
            document.getElementById('admin-container').style.display = 'none';
        }

        function showDashboard() {
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('admin-container').style.display = 'flex';
            updateDashboardStats();
        }

        function showSection(sectionName) {
            // すべてのセクションを非表示
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            // メニューアイテムのアクティブ状態更新
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });

            // 選択されたセクションを表示
            const targetSection = document.getElementById(sectionName);
            if (targetSection) {
                targetSection.classList.add('active');
            }

            // 対応するメニューアイテムをアクティブに
            const targetMenuItem = document.querySelector(`[data-section="${sectionName}"]`);
            if (targetMenuItem) {
                targetMenuItem.classList.add('active');
            }

            // セクション固有の処理
            if (sectionName === 'news') {
                renderNews();
            } else if (sectionName === 'products') {
                renderProducts();
            } else if (sectionName === 'gifts') {
                renderGifts();
            } else if (sectionName === 'reviews') {
                renderReviews();
            } else if (sectionName === 'settings') {
                loadSettings();
            }
        }

        function loadData() {
            try {
                const savedData = localStorage.getItem('wasui_data');
                if (savedData) {
                    currentData = JSON.parse(savedData);
                } else {
                    currentData = getDefaultData();
                }
                updateDashboardStats();
            } catch (error) {
                console.error('データ読み込みエラー:', error);
                currentData = getDefaultData();
            }
        }

        function getDefaultData() {
            return {
                news: [],
                products: [],
                gifts: [],
                reviews: [],
                settings: {
                    siteName: "和粋 WASUI",
                    phone: "",
                    address: "",
                    hours: "",
                    email: "",
                    lastUpdated: new Date().toISOString()
                }
            };
        }

        function updateDashboardStats() {
            if (!currentData) return;

            document.getElementById('stats-news').textContent = currentData.news?.length || 0;
            document.getElementById('stats-products').textContent = currentData.products?.length || 0;
            document.getElementById('stats-gifts').textContent = currentData.gifts?.length || 0;
            document.getElementById('stats-reviews').textContent = currentData.reviews?.length || 0;
        }

        function saveData() {
            localStorage.setItem('wasui_data', JSON.stringify(currentData));

            // 個別データファイルを出力（フロントエンド用）
            exportDataToJSON();
            updateDashboardStats();
        }

        // ユーティリティ関数（全体で使用）
        function formatDate(dateString) {
            if (!dateString) return '日付未設定';
            const date = new Date(dateString);
            return `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')}`;
        }

        function getProductCategoryClass(category) {
            const classes = {
                'バウムクーヘン': 'category-baum',
                '季節限定品': 'category-seasonal',
                'ギフトセット': 'category-gift',
                '焼菓子': 'category-baked',
                'その他': 'category-other'
            };
            return classes[category] || 'category-default';
        }

        function getGiftTypeClass(type) {
            const classes = {
                '詰合せ': 'type-assortment',
                'ギフトボックス': 'type-box',
                '季節限定': 'type-seasonal',
                'のし対応': 'type-noshi',
                'カスタムギフト': 'type-custom'
            };
            return classes[type] || 'type-default';
        }

        function getStarRating(rating) {
            if (!rating) return '評価なし';
            return '★'.repeat(rating) + '☆'.repeat(5 - rating);
        }

        // JSONファイルとしてデータをエクスポート（フロントエンド連携用）
        function exportDataToJSON() {
            // 個別のJSONファイルを生成
            const exports = {
                news: currentData.news || [],
                products: currentData.products || [],
                gifts: currentData.gifts || [],
                reviews: currentData.reviews || [],
                settings: currentData.settings || {}
            };

            // 各データタイプのJSONを生成
            Object.keys(exports).forEach(key => {
                const jsonString = JSON.stringify(exports[key], null, 2);
                downloadJSON(jsonString, `wasui_${key}.json`);
            });

            // 統合データファイルも生成
            const allData = JSON.stringify(exports, null, 2);
            downloadJSON(allData, 'wasui_all_data.json');
        }

        // JSONファイルダウンロード機能
        function downloadJSON(jsonString, filename) {
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // データエクスポートボタン機能
        function exportAllData() {
            if (!currentData || Object.keys(currentData).length === 0) {
                showNotification('エクスポートするデータがありません', 'error');
                return;
            }

            exportDataToJSON();
            showNotification('データをJSONファイルとしてエクスポートしました', 'success');
        }

        // お知らせ関連
        function openNewsModal(newsId = null) {
            const modal = document.getElementById('news-modal');
            const title = document.getElementById('news-modal-title');

            if (newsId) {
                title.textContent = 'お知らせ編集';
                const news = currentData.news.find(n => n.id === newsId);
                if (news) {
                    document.getElementById('news-title').value = news.title || '';
                    document.getElementById('news-category').value = news.category || '';
                    document.getElementById('news-date').value = news.date || '';
                    document.getElementById('news-priority').value = news.priority || 'normal';
                    document.getElementById('news-summary').value = news.summary || '';
                    document.getElementById('news-content').value = news.content || '';
                    document.getElementById('news-tags').value = news.tags || '';
                    document.getElementById('news-featured').checked = news.featured || false;
                    document.getElementById('news-active').checked = news.active !== false;

                    if (news.image) {
                        document.getElementById('news-image-preview').innerHTML = `
                            <div class="image-preview-container">
                                <img src="${getImageUrl(news.image)}" alt="現在の画像" style="max-width: 200px; max-height: 150px; border-radius: 8px;">
                                <p style="margin-top: 5px; font-size: 12px; color: #666;">現在の画像</p>
                            </div>
                        `;
                        document.getElementById('news-image').value = news.image;
                    }
                }
            } else {
                title.textContent = '新規お知らせ';
                document.getElementById('news-form').reset();
                document.getElementById('news-image-preview').innerHTML = '';
                document.getElementById('news-date').value = new Date().toISOString().split('T')[0];
                document.getElementById('news-active').checked = true;
            }

            modal.style.display = 'block';
        }

        function closeNewsModal() {
            document.getElementById('news-modal').style.display = 'none';
        }

        function saveNews() {
            const formData = {
                title: document.getElementById('news-title').value,
                category: document.getElementById('news-category').value,
                date: document.getElementById('news-date').value,
                priority: document.getElementById('news-priority').value,
                summary: document.getElementById('news-summary').value,
                content: document.getElementById('news-content').value,
                image: document.getElementById('news-image').value,
                tags: document.getElementById('news-tags').value,
                featured: document.getElementById('news-featured').checked,
                active: document.getElementById('news-active').checked
            };

            if (!formData.title || !formData.category || !formData.summary) {
                showNotification('必須項目を入力してください', 'error');
                return;
            }

            if (!currentData.news) currentData.news = [];

            formData.id = Date.now();
            formData.createdAt = new Date().toISOString();
            currentData.news.push(formData);

            saveData();
            closeNewsModal();
            renderNews();
            showNotification('お知らせを保存しました', 'success');
        }

        function deleteNews(newsId) {
            if (confirm('このお知らせを削除してもよろしいですか？')) {
                currentData.news = currentData.news.filter(n => n.id !== newsId);
                saveData();
                renderNews();
                showNotification('お知らせを削除しました', 'success');
            }
        }

        function renderNews() {
            const container = document.getElementById('news-list');
            if (!currentData.news || currentData.news.length === 0) {
                container.innerHTML = '<p>お知らせが登録されていません。</p>';
                return;
            }

            const html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>画像</th>
                            <th>タイトル</th>
                            <th>カテゴリ</th>
                            <th>公開日</th>
                            <th>優先度</th>
                            <th>ステータス</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${currentData.news.map(news => `
                            <tr>
                                <td>
                                    ${news.image ?
                                        `<img src="${getImageUrl(news.image)}" alt="${news.title}" style="width: 50px; height: 40px; object-fit: cover; border-radius: 4px;">` :
                                        '📰'
                                    }
                                </td>
                                <td>
                                    <strong>${news.title}</strong>
                                    ${news.featured ? '<span style="color: #d4af37; margin-left: 5px;">⭐</span>' : ''}
                                </td>
                                <td>
                                    <span class="status-badge ${getCategoryClass(news.category)}">
                                        ${news.category}
                                    </span>
                                </td>
                                <td>${new Date(news.date).toLocaleDateString('ja-JP')}</td>
                                <td>
                                    <span class="status-badge ${getPriorityClass(news.priority)}">
                                        ${getPriorityLabel(news.priority)}
                                    </span>
                                </td>
                                <td>
                                    <span class="status-badge ${news.active ? 'status-active' : 'status-inactive'}">
                                        ${news.active ? '公開中' : '非公開'}
                                    </span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-sm btn-edit" onclick="openNewsModal(${news.id})">編集</button>
                                        <button class="btn-sm btn-delete" onclick="deleteNews(${news.id})">削除</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            container.innerHTML = html;
        }

        function getCategoryClass(category) {
            const classes = {
                '新商品': 'category-new',
                'キャンペーン': 'category-campaign',
                'お知らせ': 'category-notice',
                'イベント': 'category-event',
                '重要': 'category-important'
            };
            return classes[category] || 'status-active';
        }

        function getPriorityClass(priority) {
            const classes = {
                'normal': 'status-active',
                'high': 'status-warning',
                'urgent': 'status-inactive'
            };
            return classes[priority] || 'status-active';
        }

        function getPriorityLabel(priority) {
            const labels = {
                'normal': '通常',
                'high': '高',
                'urgent': '緊急'
            };
            return labels[priority] || '通常';
        }

        // 商品関連
        function openProductModal(productId = null) {
            const modal = document.getElementById('product-modal');
            const title = document.getElementById('product-modal-title');

            if (productId) {
                title.textContent = '商品編集';
                window.editingProductId = productId;
                const product = currentData.products.find(p => p.id === productId);
                if (product) {
                    document.getElementById('product-title').value = product.title || '';
                    document.getElementById('product-category').value = product.category || '';
                    document.getElementById('product-price').value = product.price || '';
                    document.getElementById('product-date').value = product.date || '';
                    document.getElementById('product-description').value = product.description || '';
                    document.getElementById('product-ingredients').value = product.ingredients || '';
                    document.getElementById('product-tags').value = product.tags || '';
                    document.getElementById('product-featured').checked = product.featured || false;
                    document.getElementById('product-active').checked = product.active !== false;

                    if (product.image) {
                        document.getElementById('product-image-preview').innerHTML = `
                            <div class="image-preview-container">
                                <img src="${getImageUrl(product.image)}" alt="現在の画像" style="max-width: 200px; max-height: 150px; border-radius: 8px;">
                                <p style="margin-top: 5px; font-size: 12px; color: #666;">現在の画像</p>
                            </div>
                        `;
                        document.getElementById('product-image').value = product.image;
                    }
                }
            } else {
                title.textContent = '新規商品登録';
                window.editingProductId = null;
                document.getElementById('product-form').reset();
                document.getElementById('product-image-preview').innerHTML = '';
                document.getElementById('product-date').value = new Date().toISOString().split('T')[0];
                document.getElementById('product-active').checked = true;
            }

            modal.style.display = 'block';
        }

        function closeProductModal() {
            document.getElementById('product-modal').style.display = 'none';
        }

        function saveProduct() {
            const formData = {
                title: document.getElementById('product-title').value,
                category: document.getElementById('product-category').value,
                price: document.getElementById('product-price').value,
                date: document.getElementById('product-date').value,
                description: document.getElementById('product-description').value,
                ingredients: document.getElementById('product-ingredients').value,
                image: document.getElementById('product-image').value,
                tags: document.getElementById('product-tags').value,
                featured: document.getElementById('product-featured').checked,
                active: document.getElementById('product-active').checked
            };

            if (!formData.title.trim()) {
                showNotification('商品名を入力してください', 'error');
                return;
            }

            if (!formData.category) {
                showNotification('カテゴリを選択してください', 'error');
                return;
            }

            if (!formData.price.trim()) {
                showNotification('価格を入力してください', 'error');
                return;
            }

            if (!formData.description.trim()) {
                showNotification('商品説明を入力してください', 'error');
                return;
            }

            const existingProductIndex = currentData.products.findIndex(p =>
                p.title === formData.title && (!window.editingProductId || p.id !== window.editingProductId)
            );

            if (existingProductIndex !== -1) {
                showNotification('同じ商品名が既に存在します', 'error');
                return;
            }

            if (window.editingProductId) {
                const productIndex = currentData.products.findIndex(p => p.id === window.editingProductId);
                if (productIndex !== -1) {
                    currentData.products[productIndex] = {
                        ...currentData.products[productIndex],
                        ...formData,
                        updatedAt: new Date().toISOString()
                    };
                }
                showNotification('商品情報を更新しました', 'success');
                window.editingProductId = null;
            } else {
                const newProduct = {
                    ...formData,
                    id: 'product_' + Date.now(),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                currentData.products.push(newProduct);
                showNotification('新しい商品を登録しました', 'success');
            }

            saveData();
            closeProductModal();
            renderProducts();
        }

        function deleteProduct(productId) {
            if (confirm('この商品を削除してもよろしいですか？')) {
                const productIndex = currentData.products.findIndex(p => p.id === productId);
                if (productIndex !== -1) {
                    const deletedProduct = currentData.products.splice(productIndex, 1)[0];
                    saveData();
                    renderProducts();
                    showNotification(`「${deletedProduct.title}」を削除しました`, 'success');
                }
            }
        }

        function renderProducts() {
            const productsContainer = document.getElementById('products-list');
            if (!currentData.products) currentData.products = [];

            productsContainer.innerHTML = '';

            if (currentData.products.length === 0) {
                productsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-shopping-cart" style="font-size: 48px; color: #ccc; margin-bottom: 16px;"></i>
                        <h3>商品が登録されていません</h3>
                        <p>「新規商品登録」ボタンから最初の商品を登録してください。</p>
                    </div>
                `;
                return;
            }

            currentData.products.forEach(product => {
                const productElement = document.createElement('div');
                productElement.className = 'news-item';
                productElement.innerHTML = `
                    <div class="news-header">
                        <h3>${product.title || '無題'}</h3>
                        <div class="news-actions">
                            <button class="btn btn-sm btn-outline" onclick="openProductModal('${product.id}')">
                                <i class="fas fa-edit"></i> 編集
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteProduct('${product.id}')">
                                <i class="fas fa-trash"></i> 削除
                            </button>
                        </div>
                    </div>
                    <div class="news-meta">
                        <span class="badge ${getProductCategoryClass(product.category)}">${product.category || '未分類'}</span>
                        <span class="meta-item"><i class="fas fa-yen-sign"></i> ${product.price || '価格未設定'}</span>
                        <span class="meta-item"><i class="fas fa-calendar"></i> ${formatDate(product.date)}</span>
                        <span class="status-badge ${product.active ? 'active' : 'inactive'}">
                            ${product.active ? '公開中' : '非公開'}
                        </span>
                    </div>
                    <div class="news-content">
                        ${product.image ? `<img src="${getImageUrl(product.image)}" alt="${product.title}" class="content-image">` : ''}
                        <p>${product.description || '説明がありません'}</p>
                    </div>
                `;
                productsContainer.appendChild(productElement);
            });
        }


        // ギフト関連
        function openGiftModal(giftId = null) {
            const modal = document.getElementById('gift-modal');
            const title = document.getElementById('gift-modal-title');

            if (giftId) {
                title.textContent = 'ギフト編集';
                window.editingGiftId = giftId;
                const gift = currentData.gifts.find(g => g.id === giftId);
                if (gift) {
                    document.getElementById('gift-title').value = gift.title || '';
                    document.getElementById('gift-type').value = gift.type || '';
                    document.getElementById('gift-price').value = gift.price || '';
                    document.getElementById('gift-date').value = gift.date || '';
                    document.getElementById('gift-contents').value = gift.contents || '';
                    document.getElementById('gift-description').value = gift.description || '';
                    document.getElementById('gift-tags').value = gift.tags || '';
                    document.getElementById('gift-noshi').checked = gift.noshi || false;
                    document.getElementById('gift-wrapping').checked = gift.wrapping || false;
                    document.getElementById('gift-message').checked = gift.message || false;
                    document.getElementById('gift-featured').checked = gift.featured || false;
                    document.getElementById('gift-active').checked = gift.active !== false;

                    if (gift.image) {
                        document.getElementById('gift-image-preview').innerHTML = `
                            <div class="image-preview-container">
                                <img src="${getImageUrl(gift.image)}" alt="現在の画像" style="max-width: 200px; max-height: 150px; border-radius: 8px;">
                                <p style="margin-top: 5px; font-size: 12px; color: #666;">現在の画像</p>
                            </div>
                        `;
                        document.getElementById('gift-image').value = gift.image;
                    }
                }
            } else {
                title.textContent = '新規ギフト登録';
                window.editingGiftId = null;
                document.getElementById('gift-form').reset();
                document.getElementById('gift-image-preview').innerHTML = '';
                document.getElementById('gift-date').value = new Date().toISOString().split('T')[0];
                document.getElementById('gift-active').checked = true;
            }

            modal.style.display = 'block';
        }

        function closeGiftModal() {
            document.getElementById('gift-modal').style.display = 'none';
        }

        function saveGift() {
            const formData = {
                title: document.getElementById('gift-title').value,
                type: document.getElementById('gift-type').value,
                price: document.getElementById('gift-price').value,
                date: document.getElementById('gift-date').value,
                contents: document.getElementById('gift-contents').value,
                description: document.getElementById('gift-description').value,
                image: document.getElementById('gift-image').value,
                tags: document.getElementById('gift-tags').value,
                noshi: document.getElementById('gift-noshi').checked,
                wrapping: document.getElementById('gift-wrapping').checked,
                message: document.getElementById('gift-message').checked,
                featured: document.getElementById('gift-featured').checked,
                active: document.getElementById('gift-active').checked
            };

            if (!formData.title.trim()) {
                showNotification('ギフト名を入力してください', 'error');
                return;
            }

            if (!formData.type) {
                showNotification('ギフトタイプを選択してください', 'error');
                return;
            }

            if (!formData.price.trim()) {
                showNotification('価格を入力してください', 'error');
                return;
            }

            if (!formData.contents.trim()) {
                showNotification('ギフト内容を入力してください', 'error');
                return;
            }

            const existingGiftIndex = currentData.gifts.findIndex(g =>
                g.title === formData.title && (!window.editingGiftId || g.id !== window.editingGiftId)
            );

            if (existingGiftIndex !== -1) {
                showNotification('同じギフト名が既に存在します', 'error');
                return;
            }

            if (window.editingGiftId) {
                const giftIndex = currentData.gifts.findIndex(g => g.id === window.editingGiftId);
                if (giftIndex !== -1) {
                    currentData.gifts[giftIndex] = {
                        ...currentData.gifts[giftIndex],
                        ...formData,
                        updatedAt: new Date().toISOString()
                    };
                }
                showNotification('ギフト情報を更新しました', 'success');
                window.editingGiftId = null;
            } else {
                const newGift = {
                    ...formData,
                    id: 'gift_' + Date.now(),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                currentData.gifts.push(newGift);
                showNotification('新しいギフトを登録しました', 'success');
            }

            saveData();
            closeGiftModal();
            renderGifts();
        }

        function deleteGift(giftId) {
            if (confirm('このギフトを削除してもよろしいですか？')) {
                const giftIndex = currentData.gifts.findIndex(g => g.id === giftId);
                if (giftIndex !== -1) {
                    const deletedGift = currentData.gifts.splice(giftIndex, 1)[0];
                    saveData();
                    renderGifts();
                    showNotification(`「${deletedGift.title}」を削除しました`, 'success');
                }
            }
        }

        function renderGifts() {
            const giftsContainer = document.getElementById('gifts-list');
            if (!currentData.gifts) currentData.gifts = [];

            giftsContainer.innerHTML = '';

            if (currentData.gifts.length === 0) {
                giftsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-gift" style="font-size: 48px; color: #ccc; margin-bottom: 16px;"></i>
                        <h3>ギフトが登録されていません</h3>
                        <p>「新規ギフト登録」ボタンから最初のギフトを登録してください。</p>
                    </div>
                `;
                return;
            }

            currentData.gifts.forEach(gift => {
                const giftElement = document.createElement('div');
                giftElement.className = 'news-item';
                giftElement.innerHTML = `
                    <div class="news-header">
                        <h3>${gift.title || '無題'}</h3>
                        <div class="news-actions">
                            <button class="btn btn-sm btn-outline" onclick="openGiftModal('${gift.id}')">
                                <i class="fas fa-edit"></i> 編集
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteGift('${gift.id}')">
                                <i class="fas fa-trash"></i> 削除
                            </button>
                        </div>
                    </div>
                    <div class="news-meta">
                        <span class="badge ${getGiftTypeClass(gift.type)}">${gift.type || '未分類'}</span>
                        <span class="meta-item"><i class="fas fa-yen-sign"></i> ${gift.price || '価格未設定'}</span>
                        <span class="meta-item"><i class="fas fa-calendar"></i> ${formatDate(gift.date)}</span>
                        <span class="status-badge ${gift.active ? 'active' : 'inactive'}">
                            ${gift.active ? '販売中' : '非公開'}
                        </span>
                    </div>
                    <div class="news-content">
                        ${gift.image ? `<img src="${getImageUrl(gift.image)}" alt="${gift.title}" class="content-image">` : ''}
                        <p>${gift.contents || '内容が登録されていません'}</p>
                        ${getGiftServices(gift)}
                    </div>
                `;
                giftsContainer.appendChild(giftElement);
            });
        }


        function getGiftServices(gift) {
            const services = [];
            if (gift.noshi) services.push('のし対応');
            if (gift.wrapping) services.push('包装対応');
            if (gift.message) services.push('メッセージカード');

            return services.length > 0 ?
                `<div class="gift-services">🎁 ${services.join(' | ')}</div>` : '';
        }

        // レビュー関連
        function openReviewModal(reviewId = null) {
            const modal = document.getElementById('review-modal');
            const title = document.getElementById('review-modal-title');

            if (reviewId) {
                title.textContent = 'お客様の声編集';
                window.editingReviewId = reviewId;
                const review = currentData.reviews.find(r => r.id === reviewId);
                if (review) {
                    document.getElementById('review-customer-name').value = review.customerName || '';
                    document.getElementById('review-rating').value = review.rating || '';
                    document.getElementById('review-product').value = review.product || '';
                    document.getElementById('review-date').value = review.date || '';
                    document.getElementById('review-content').value = review.content || '';
                    document.getElementById('review-age').value = review.age || '';
                    document.getElementById('review-gender').value = review.gender || '';
                    document.getElementById('review-tags').value = review.tags || '';
                    document.getElementById('review-featured').checked = review.featured || false;
                    document.getElementById('review-active').checked = review.active !== false;

                    if (review.image) {
                        document.getElementById('review-image-preview').innerHTML = `
                            <div class="image-preview-container">
                                <img src="${getImageUrl(review.image)}" alt="現在の画像" style="max-width: 200px; max-height: 150px; border-radius: 8px;">
                                <p style="margin-top: 5px; font-size: 12px; color: #666;">現在の画像</p>
                            </div>
                        `;
                        document.getElementById('review-image').value = review.image;
                    }
                }
            } else {
                title.textContent = '新規お客様の声登録';
                window.editingReviewId = null;
                document.getElementById('review-form').reset();
                document.getElementById('review-image-preview').innerHTML = '';
                document.getElementById('review-date').value = new Date().toISOString().split('T')[0];
                document.getElementById('review-active').checked = true;
            }

            modal.style.display = 'block';
        }

        function closeReviewModal() {
            document.getElementById('review-modal').style.display = 'none';
        }

        function saveReview() {
            const formData = {
                customerName: document.getElementById('review-customer-name').value,
                rating: document.getElementById('review-rating').value,
                product: document.getElementById('review-product').value,
                date: document.getElementById('review-date').value,
                content: document.getElementById('review-content').value,
                age: document.getElementById('review-age').value,
                gender: document.getElementById('review-gender').value,
                image: document.getElementById('review-image').value,
                tags: document.getElementById('review-tags').value,
                featured: document.getElementById('review-featured').checked,
                active: document.getElementById('review-active').checked
            };

            if (!formData.customerName.trim()) {
                showNotification('お客様名を入力してください', 'error');
                return;
            }

            if (!formData.rating) {
                showNotification('評価を選択してください', 'error');
                return;
            }

            if (!formData.content.trim()) {
                showNotification('お客様の声を入力してください', 'error');
                return;
            }

            if (window.editingReviewId) {
                const reviewIndex = currentData.reviews.findIndex(r => r.id === window.editingReviewId);
                if (reviewIndex !== -1) {
                    currentData.reviews[reviewIndex] = {
                        ...currentData.reviews[reviewIndex],
                        ...formData,
                        updatedAt: new Date().toISOString()
                    };
                }
                showNotification('お客様の声を更新しました', 'success');
                window.editingReviewId = null;
            } else {
                const newReview = {
                    ...formData,
                    id: 'review_' + Date.now(),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                currentData.reviews.push(newReview);
                showNotification('新しいお客様の声を登録しました', 'success');
            }

            saveData();
            closeReviewModal();
            renderReviews();
        }

        function deleteReview(reviewId) {
            if (confirm('このお客様の声を削除してもよろしいですか？')) {
                const reviewIndex = currentData.reviews.findIndex(r => r.id === reviewId);
                if (reviewIndex !== -1) {
                    const deletedReview = currentData.reviews.splice(reviewIndex, 1)[0];
                    saveData();
                    renderReviews();
                    showNotification(`「${deletedReview.customerName}様」の声を削除しました`, 'success');
                }
            }
        }

        function renderReviews() {
            const reviewsContainer = document.getElementById('reviews-list');
            if (!currentData.reviews) currentData.reviews = [];

            reviewsContainer.innerHTML = '';

            if (currentData.reviews.length === 0) {
                reviewsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-comments" style="font-size: 48px; color: #ccc; margin-bottom: 16px;"></i>
                        <h3>お客様の声が登録されていません</h3>
                        <p>「新規お客様の声登録」ボタンから最初のレビューを登録してください。</p>
                    </div>
                `;
                return;
            }

            currentData.reviews.forEach(review => {
                const reviewElement = document.createElement('div');
                reviewElement.className = 'news-item';
                reviewElement.innerHTML = `
                    <div class="news-header">
                        <h3>${review.customerName || '匿名'}様</h3>
                        <div class="news-actions">
                            <button class="btn btn-sm btn-outline" onclick="openReviewModal('${review.id}')">
                                <i class="fas fa-edit"></i> 編集
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteReview('${review.id}')">
                                <i class="fas fa-trash"></i> 削除
                            </button>
                        </div>
                    </div>
                    <div class="news-meta">
                        <span class="badge category-review">${getStarRating(review.rating)}</span>
                        ${review.product ? `<span class="meta-item"><i class="fas fa-shopping-bag"></i> ${review.product}</span>` : ''}
                        <span class="meta-item"><i class="fas fa-calendar"></i> ${formatDate(review.date)}</span>
                        ${review.age || review.gender ? `<span class="meta-item"><i class="fas fa-user"></i> ${[review.age, review.gender].filter(x => x).join(' ')}</span>` : ''}
                        <span class="status-badge ${review.active ? 'active' : 'inactive'}">
                            ${review.active ? '公開中' : '非公開'}
                        </span>
                    </div>
                    <div class="news-content">
                        ${review.image ? `<img src="${getImageUrl(review.image)}" alt="${review.customerName}様" class="content-image">` : ''}
                        <p>"${review.content || 'コメントがありません'}"</p>
                    </div>
                `;
                reviewsContainer.appendChild(reviewElement);
            });
        }


        // サイト設定関連
        function loadSettings() {
            if (currentData.settings) {
                document.getElementById('site-name').value = currentData.settings.siteName || '';
                document.getElementById('site-phone').value = currentData.settings.phone || '';
                document.getElementById('site-address').value = currentData.settings.address || '';
                document.getElementById('site-hours').value = currentData.settings.hours || '';
                document.getElementById('site-email').value = currentData.settings.email || '';
                document.getElementById('site-description').value = currentData.settings.description || '';
                document.getElementById('site-facebook').value = currentData.settings.facebook || '';
                document.getElementById('site-instagram').value = currentData.settings.instagram || '';
                document.getElementById('site-twitter').value = currentData.settings.twitter || '';
                document.getElementById('site-line').value = currentData.settings.line || '';
                document.getElementById('site-shipping').value = currentData.settings.shipping || '';
                document.getElementById('site-notice').value = currentData.settings.notice || '';
            }
        }

        function saveSettings() {
            const formData = {
                siteName: document.getElementById('site-name').value,
                phone: document.getElementById('site-phone').value,
                address: document.getElementById('site-address').value,
                hours: document.getElementById('site-hours').value,
                email: document.getElementById('site-email').value,
                description: document.getElementById('site-description').value,
                facebook: document.getElementById('site-facebook').value,
                instagram: document.getElementById('site-instagram').value,
                twitter: document.getElementById('site-twitter').value,
                line: document.getElementById('site-line').value,
                shipping: document.getElementById('site-shipping').value,
                notice: document.getElementById('site-notice').value,
                lastUpdated: new Date().toISOString()
            };

            // 基本情報のバリデーション
            if (!formData.siteName.trim()) {
                showNotification('サイト名を入力してください', 'error');
                return;
            }

            currentData.settings = formData;
            saveData();
            showNotification('設定を保存しました', 'success');
        }

        // 通知表示
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // 画像アップロード機能
        function handleImageUpload(input, previewId) {
            const file = input.files[0];
            const previewDiv = document.getElementById(previewId);
            const hiddenInput = input.parentElement.querySelector('input[type="hidden"]');

            if (!file) {
                previewDiv.innerHTML = '';
                if (hiddenInput) hiddenInput.value = '';
                return;
            }

            // ファイルサイズチェック (2MB制限)
            if (file.size > 2 * 1024 * 1024) {
                alert('⚠️ ファイルサイズが大きすぎます。2MB以下の画像を選択してください。');
                input.value = '';
                return;
            }

            // ファイル形式チェック
            if (!file.type.startsWith('image/')) {
                alert('⚠️ 画像ファイルを選択してください。');
                input.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                // プレビュー表示
                previewDiv.innerHTML = `
                    <div class="image-preview-container">
                        <img src="${e.target.result}" alt="プレビュー" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 2px solid #ddd;">
                        <p style="margin-top: 5px; font-size: 12px; color: #666;">
                            📁 ${file.name} (${(file.size / 1024).toFixed(1)}KB)
                        </p>
                        <button type="button" onclick="removeImagePreview('${previewId}', '${input.id}')"
                                style="margin-top: 5px; padding: 4px 8px; background: #dc3545; color: white; border: none; border-radius: 4px; font-size: 12px; cursor: pointer;">
                            🗑️ 削除
                        </button>
                    </div>
                `;

                // Base64データを隠しフィールドに保存
                if (hiddenInput) {
                    hiddenInput.value = e.target.result;
                }
            };

            reader.readAsDataURL(file);
        }

        // 画像プレビュー削除
        function removeImagePreview(previewId, inputId) {
            document.getElementById(previewId).innerHTML = '';
            document.getElementById(inputId).value = '';
            const hiddenInput = document.getElementById(inputId).parentElement.querySelector('input[type="hidden"]');
            if (hiddenInput) hiddenInput.value = '';
        }

        // 画像URL生成 (Base64またはパス)
        function getImageUrl(imageData) {
            if (!imageData) return 'images/default-placeholder.jpg';

            // Base64データの場合
            if (imageData.startsWith('data:image/')) {
                return imageData;
            }

            // パスの場合
            return imageData;
        }

        // 商品削除機能の追加（既存のrenderProducts()を活用）
        function deleteProduct(productId) {
            if (confirm('この商品を削除してもよろしいですか？')) {
                const productIndex = currentData.products.findIndex(p => p.id === productId);
                if (productIndex !== -1) {
                    const deletedProduct = currentData.products.splice(productIndex, 1)[0];
                    saveData();
                    renderProducts();
                    showNotification(`「${deletedProduct.title}」を削除しました`, 'success');
                }
            }
        }

        // ギフト関連
        function renderGifts() {
            const container = document.getElementById('gifts-list');
            if (!currentData.gifts || currentData.gifts.length === 0) {
                container.innerHTML = '<p>ギフトが登録されていません。</p>';
                return;
            }

            const html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>画像</th>
                            <th>ギフト名</th>
                            <th>タイプ</th>
                            <th>価格</th>
                            <th>ステータス</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${currentData.gifts.map(gift => `
                            <tr>
                                <td>
                                    ${gift.image ?
                                        `<img src="${getImageUrl(gift.image)}" alt="${gift.title}" style="width: 50px; height: 40px; object-fit: cover; border-radius: 4px;">` :
                                        '🎁'
                                    }
                                </td>
                                <td>
                                    <strong>${gift.title}</strong>
                                    ${gift.featured ? '<span style="color: #d4af37; margin-left: 5px;">⭐</span>' : ''}
                                </td>
                                <td>
                                    <span class="status-badge category-${gift.type}">
                                        ${gift.type}
                                    </span>
                                </td>
                                <td>¥${gift.price ? gift.price.toLocaleString() : '未設定'}</td>
                                <td>
                                    <span class="status-badge ${gift.active ? 'status-active' : 'status-inactive'}">
                                        ${gift.active ? '販売中' : '非公開'}
                                    </span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-sm btn-edit" onclick="openGiftModal(${gift.id})">編集</button>
                                        <button class="btn-sm btn-delete" onclick="deleteGift(${gift.id})">削除</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            container.innerHTML = html;
        }

        function deleteGift(giftId) {
            if (confirm('このギフトを削除してもよろしいですか？')) {
                currentData.gifts = currentData.gifts.filter(g => g.id !== giftId);
                saveData();
                renderGifts();
                showNotification('ギフトを削除しました', 'success');
            }
        }


        // レビュー関連
        function renderReviews() {
            const container = document.getElementById('reviews-list');
            if (!currentData.reviews || currentData.reviews.length === 0) {
                container.innerHTML = '<p>お客様の声が登録されていません。</p>';
                return;
            }

            const html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>お客様</th>
                            <th>評価</th>
                            <th>商品</th>
                            <th>投稿日</th>
                            <th>ステータス</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${currentData.reviews.map(review => `
                            <tr>
                                <td>
                                    <strong>${review.customerName}</strong><br>
                                    <small>${review.age}代 ${review.gender}</small>
                                </td>
                                <td>
                                    <div style="color: #ffd700;">
                                        ${'★'.repeat(review.rating)}${'☆'.repeat(5 - review.rating)}
                                    </div>
                                    <small>${review.rating}/5</small>
                                </td>
                                <td>${review.product || '未指定'}</td>
                                <td>${new Date(review.date).toLocaleDateString('ja-JP')}</td>
                                <td>
                                    <span class="status-badge ${review.active ? 'status-active' : 'status-inactive'}">
                                        ${review.active ? '公開中' : '非公開'}
                                    </span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-sm btn-edit" onclick="openReviewModal(${review.id})">編集</button>
                                        <button class="btn-sm btn-delete" onclick="deleteReview(${review.id})">削除</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            container.innerHTML = html;
        }

        function deleteReview(reviewId) {
            if (confirm('このお客様の声を削除してもよろしいですか？')) {
                currentData.reviews = currentData.reviews.filter(r => r.id !== reviewId);
                saveData();
                renderReviews();
                showNotification('お客様の声を削除しました', 'success');
            }
        }

        // モーダル外クリックで閉じる
        window.onclick = function(event) {
            const newsModal = document.getElementById('news-modal');

            if (event.target === newsModal) {
                closeNewsModal();
            }
        }
    </script>
</body>
</html>